
-- 6. Program Management: Other Expenses
create table if not exists other_program_expenses (
  "id" bigint primary key generated always as identity
);

ALTER TABLE other_program_expenses ADD COLUMN IF NOT EXISTS "uid" text;
ALTER TABLE other_program_expenses ADD COLUMN IF NOT EXISTS "operatingUnit" text;
ALTER TABLE other_program_expenses ADD COLUMN IF NOT EXISTS "uacsCode" text;
ALTER TABLE other_program_expenses ADD COLUMN IF NOT EXISTS "obligationDate" text;
ALTER TABLE other_program_expenses ADD COLUMN IF NOT EXISTS "disbursementDate" text;
ALTER TABLE other_program_expenses ADD COLUMN IF NOT EXISTS "fundType" text;
ALTER TABLE other_program_expenses ADD COLUMN IF NOT EXISTS "fundYear" integer;
ALTER TABLE other_program_expenses ADD COLUMN IF NOT EXISTS "tier" text;
ALTER TABLE other_program_expenses ADD COLUMN IF NOT EXISTS "encodedBy" text;
ALTER TABLE other_program_expenses ADD COLUMN IF NOT EXISTS "actualDate" text;
ALTER TABLE other_program_expenses ADD COLUMN IF NOT EXISTS "actualAmount" numeric;
ALTER TABLE other_program_expenses ADD COLUMN IF NOT EXISTS "actualObligationDate" text;
ALTER TABLE other_program_expenses ADD COLUMN IF NOT EXISTS "actualDisbursementDate" text;
ALTER TABLE other_program_expenses ADD COLUMN IF NOT EXISTS "actualObligationAmount" numeric;
ALTER TABLE other_program_expenses ADD COLUMN IF NOT EXISTS "actualDisbursementAmount" numeric;
ALTER TABLE other_program_expenses ADD COLUMN IF NOT EXISTS "particulars" text;
ALTER TABLE other_program_expenses ADD COLUMN IF NOT EXISTS "amount" numeric;
ALTER TABLE other_program_expenses ADD COLUMN IF NOT EXISTS "obligatedAmount" numeric default 0;
-- Monthly Disbursement Schedule (Target)
ALTER TABLE other_program_expenses ADD COLUMN IF NOT EXISTS "disbursementJan" numeric default 0;
ALTER TABLE other_program_expenses ADD COLUMN IF NOT EXISTS "disbursementFeb" numeric default 0;
ALTER TABLE other_program_expenses ADD COLUMN IF NOT EXISTS "disbursementMar" numeric default 0;
ALTER TABLE other_program_expenses ADD COLUMN IF NOT EXISTS "disbursementApr" numeric default 0;
ALTER TABLE other_program_expenses ADD COLUMN IF NOT EXISTS "disbursementMay" numeric default 0;
ALTER TABLE other_program_expenses ADD COLUMN IF NOT EXISTS "disbursementJun" numeric default 0;
ALTER TABLE other_program_expenses ADD COLUMN IF NOT EXISTS "disbursementJul" numeric default 0;
ALTER TABLE other_program_expenses ADD COLUMN IF NOT EXISTS "disbursementAug" numeric default 0;
ALTER TABLE other_program_expenses ADD COLUMN IF NOT EXISTS "disbursementSep" numeric default 0;
ALTER TABLE other_program_expenses ADD COLUMN IF NOT EXISTS "disbursementOct" numeric default 0;
ALTER TABLE other_program_expenses ADD COLUMN IF NOT EXISTS "disbursementNov" numeric default 0;
ALTER TABLE other_program_expenses ADD COLUMN IF NOT EXISTS "disbursementDec" numeric default 0;
-- Monthly Disbursement Schedule (Actual)
ALTER TABLE other_program_expenses ADD COLUMN IF NOT EXISTS "actualDisbursementJan" numeric default 0;
ALTER TABLE other_program_expenses ADD COLUMN IF NOT EXISTS "actualDisbursementFeb" numeric default 0;
ALTER TABLE other_program_expenses ADD COLUMN IF NOT EXISTS "actualDisbursementMar" numeric default 0;
ALTER TABLE other_program_expenses ADD COLUMN IF NOT EXISTS "actualDisbursementApr" numeric default 0;
ALTER TABLE other_program_expenses ADD COLUMN IF NOT EXISTS "actualDisbursementMay" numeric default 0;
ALTER TABLE other_program_expenses ADD COLUMN IF NOT EXISTS "actualDisbursementJun" numeric default 0;
ALTER TABLE other_program_expenses ADD COLUMN IF NOT EXISTS "actualDisbursementJul" numeric default 0;
ALTER TABLE other_program_expenses ADD COLUMN IF NOT EXISTS "actualDisbursementAug" numeric default 0;
ALTER TABLE other_program_expenses ADD COLUMN IF NOT EXISTS "actualDisbursementSep" numeric default 0;
ALTER TABLE other_program_expenses ADD COLUMN IF NOT EXISTS "actualDisbursementOct" numeric default 0;
ALTER TABLE other_program_expenses ADD COLUMN IF NOT EXISTS "actualDisbursementNov" numeric default 0;
ALTER TABLE other_program_expenses ADD COLUMN IF NOT EXISTS "actualDisbursementDec" numeric default 0;

ALTER TABLE other_program_expenses ADD COLUMN IF NOT EXISTS "created_at" timestamptz default now();
ALTER TABLE other_program_expenses ADD COLUMN IF NOT EXISTS "updated_at" timestamptz default now();

-- Update Note for IPOs table:
-- The 'commodities' column in the 'ipos' table is of type JSONB. 
-- The internal structure of the JSON objects within this array has been updated.
-- New optional fields added to commodity objects:
--   "marketingPercentage": number
--   "foodSecurityPercentage": number
--   "averageIncome": number
-- No DDL changes are required for the 'ipos' table itself as it stores JSON.

-- Update Note for Subprojects table:
-- The 'details' column in the 'subprojects' table is of type JSONB.
-- Added "actualNumberOfUnits" (number) to detail objects.
-- The 'subprojectCommodities' column in the 'subprojects' table is of type JSONB.
-- Added new optional fields to commodity objects:
--   "marketingPercentage": number
--   "foodSecurityPercentage": number
--   "income": number
-- No DDL changes are required for the 'subprojects' table itself as it stores JSON.

ALTER TABLE subprojects ADD COLUMN IF NOT EXISTS "ipo_id" bigint;

ALTER TABLE activities ADD COLUMN IF NOT EXISTS "endDate" text;

-- 7. IPO History
create table if not exists ipo_history (
  "id" bigint primary key generated always as identity,
  "ipo_id" bigint not null,
  "event" text not null,
  "user" text,
  "date" timestamptz default now(),
  "created_at" timestamptz default now()
);
